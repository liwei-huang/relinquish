# Vlang

å­¦ä¹  V è¯­è¨€ã€‚

## å‘½ä»¤

| å‘½ä»¤             | åŠŸèƒ½       |
| ---------------- | ---------- |
| `v run <file>.v` | ç¼–è¯‘å¹¶è¿è¡Œ |
| `v <file>.v`     | ç¼–è¯‘       |
| `v version`      | ç‰ˆæœ¬       |

> æç¤ºï¼š`v --v-flag run <source_file>.v --program-flag` å³ï¼Œ`run` ä¹‹å‰çš„ **flag** å±äº V ç¼–è¯‘å™¨çš„ï¼Œè€Œ `run` ä¹‹åçš„ **flag** å±äºç¨‹åºçš„ã€‚

## é¢„å¤‡çŸ¥è¯†

éœ‘ï¼š

- `main` æ˜¯ä¸»å‡½æ•°ï¼Œç¨‹åºçš„å…¥å£
- è„šæœ¬æ–‡ä»¶ï¼Œæº˜ä¸å†™ `pub fn main {}`ï¼Œå®ƒå°†éšå¼å­˜åœ¨

æ³¨é‡Šï¼š

- å•è¡Œæ³¨é‡Šï¼Œ`// ...`
- å¤šè¡Œæ³¨é‡Šï¼Œå¯åµŒå¥—ï¼Œ`/* ... */`

é£æ ¼ï¼š

- å•ä½åˆ¶è¡¨ç¬¦æ˜¯ 4 ä¸ªç©ºæ ¼
- ä¸å†™åˆ†å·ï¼ˆ`;`ï¼‰
- èŠ±æ‹¬å·ï¼ˆ`{}`ï¼‰é£æ ¼
- å‘½å
  - å˜é‡ã€å‡½æ•°ï¼Œ`snake_case`
  - ç±»å‹ï¼Œ`PascalCase`

## å˜é‡

æœ¬æ–‡æ¡£ä¸­ç»‘å®šã€åˆå§‹åŒ–ã€èµ‹å€¼å’Œå£°æ˜ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æ˜¯é€šç”¨çš„ï¼Œåªæœ‰ç»†å¾®çš„åŒºåˆ«ï¼š

- **ç»‘å®š**ï¼Œå£°æ˜å˜é‡å¹¶ç«‹å³èµ‹å€¼ï¼Œå¼ºè°ƒè¿‡ç¨‹
- **åˆå§‹åŒ–**ï¼Œç¬¬ä¸€æ¬¡èµ‹å€¼ç»™å˜é‡ï¼Œå¼ºè°ƒç¬¬ä¸€æ¬¡èµ‹å€¼
- **èµ‹å€¼**ï¼Œèµ‹å€¼ç»™å˜é‡ï¼Œå¤šæ•°æŒ‡æ”¹å˜å˜é‡çš„å€¼
- **å£°æ˜**ï¼Œä¸ç»‘å®šä¸€æ ·ï¼Œå¼ºè°ƒå£°æ˜çš„è¯­ä¹‰

> æ³¨æ„ï¼šV ä¸­å£°æ˜å˜é‡åå¿…é¡»åˆå§‹åŒ–ï¼Œæ‰€ä»¥ä¸Šé¢è¯´å£°æ˜ä¸ç»‘å®šä¸€æ ·ã€‚

éœ‘ï¼š

- åªèƒ½åœ¨å‡½æ•°å†…å£°æ˜å˜é‡
- é»˜è®¤ï¼Œæ²¡æœ‰å…¨å±€å˜é‡
- ç¦æ­¢**å½±å­å˜é‡**
- ç¦æ­¢ä»¥ä¸‹åˆ’çº¿ï¼ˆ`_`ï¼‰å¼€å¤´èµ‰å‘½å

```v
// 1. ä½¿ç”¨ `:=` ç»‘å®šå˜é‡
name := 'å´æ¨—'
println(name)

// 2. ç±»å‹ä¾æ®å€¼èµ‰æ¨æ–­
// 2. å¦‚æœè¦æ›´æ”¹ç±»å‹ï¼Œä½¿ç”¨ç±»å‹è½¬æ¢ï¼Œä»¥ `T(v)` å½¢å¼ï¼Œ`T` æ˜¯ç±»å‹ï¼Œ`v` æ˜¯å€¼
height := u8(164)
println(height)

// 3. å¯å˜å˜é‡
mut age := u8(25)
println(age) // 25

// 4. ä½¿ç”¨ `=` æ”¹å˜å˜é‡çš„å€¼
age = 27
println(age) // 27
// 4. åŒæ—¶æ”¹å˜å¤šä¸ªå˜é‡çš„å€¼
mut a := 10
mut b := 20
mut c := 30
b, c, a = a, b, c
println([a, b, c]) // [30, 10, 20]
```

> æ³¨æ„ï¼šå¼€å‘æ¨¡å¼ä¸‹ï¼Œæœªä½¿ç”¨çš„å˜é‡ä¼šè¢«è­¦å‘Šï¼›ç”Ÿäº§æ¨¡å¼ä¸‹ï¼ˆä½¿ç”¨ `-prod` **flag**ï¼‰ï¼Œå­˜åœ¨æœªä½¿ç”¨çš„å˜é‡ï¼Œç¼–è¯‘å™¨ä¸ç¼–è¯‘æ•´ä¸ªç¨‹åºã€‚

## ç±»å‹

åŸå§‹ç±»å‹ï¼š

```txt
bool

string

rune

i8  i16  int  i64  i128 (å³å°†)
u8  u16  u32  u64  u128 (å³å°†)

f32  f64

isize  usize

voidptr

any
```

è¯´æ˜ï¼š

- `int` æ€»æ˜¯ `i32`ï¼Œä¸ä¾èµ–å¹³å°
- `isize` å’Œ `usize` ä¾èµ–å¹³å°ï¼Œ32 ä½å¹³å°æ˜¯ `int` å’Œ `u32`ï¼Œ64 ä½å¹³å°æ˜¯ `i64` å’Œ `u64`

ä¸€äº›åŸå§‹ç±»å‹çš„**ä¿ƒè¿›**ï¼š

- æ‰€æœ‰æ“ä½œç¬¦ä¸¤è¾¹çš„ç±»å‹å¿…é¡»ä¸€æ ·ï¼Œä¸è¿‡ä¸€äº›åŸå§‹ç±»å‹å­˜åœ¨ä¿ƒè¿›ï¼Œä¿ƒè¿›åä¸¤è¾¹ç±»å‹ç›¸åŒ
- ä¿ƒè¿›ï¼Œå°èŒƒå›´çš„ç±»å‹ä¿ƒè¿›ä”ºï¼ˆé€‚åº”åˆ°ï¼‰å¤§èŒƒå›´çš„ç±»å‹
- å­—é¢é‡ï¼Œä¾‹æŒï¼Œ`123` å’Œ `-4.56` ä¸ä¼šä¿ƒè¿›ï¼Œæ²¡æœ‰ä¸Šä¸‹æ–‡æç¤ºæ—¶æ˜¯ `int` å’Œ `f64` ç±»å‹

```txt
   i8 â†’ i16 â†’ int â†’ i64
                  â†˜     â†˜
                    f32 â†’ f64
                  â†—     â†—
   u8 â†’ u16 â†’ u32 â†’ u64 â¬
      â†˜     â†˜     â†˜      ptr
   i8 â†’ i16 â†’ int â†’ i64 â¬
```

```v
// 1. ä¿ƒè¿›
a := u16(10)
b := f64(20.0)
c := a + b // f64
println(c)

// 1. å­—é¢é‡ä¸ä¼šä¿ƒè¿›
d := i8(1)
e := f32(2.0)
f := 100 + d // i8
g := 100.0 + e // f32
println(f)
println(g)
```

### æ•°å­—

æ•°å­—çš„è¡¨ç¤ºæ”¯æŒä»¥ä¸‹ç‰¹æ€§ï¼š

- æ•´æ•°ä¸åŒè¿›åˆ¶çš„è¡¨ç¤ºæ³•ï¼Œ`0b` äºŒè¿›åˆ¶æ½¡ `0o` å…«è¿›åˆ¶å’Œ `0x` åå…­è¿›åˆ¶
- æµ®ç‚¹æ•°çš„ç§‘å­¦è®°æ•°æ³•ï¼Œä¾‹æŒ `123e-4`
- ä¸‹åˆ’çº¿åˆ†éš”ï¼Œä¾‹æŒ `1_000_000`
- æ•´æ•°é»˜è®¤æ˜¯ `int` ç±»å‹ï¼Œæµ®ç‚¹æ•°é»˜è®¤æ˜¯ `f64` ç±»å‹
- ç±»å‹è½¬æ¢ï¼ˆ**casting**ï¼‰ï¼Œ`T(v)` å½¢å¼ï¼Œ`T` æ˜¯ç±»å‹ï¼Œ`v` æ˜¯å€¼

### Rune

éœ‘ï¼š

- `rune` ç±»å‹ä»£è¡¨ä¸€ä¸ª Unicode å­—ç¬¦ï¼Œæ˜¯ `u32` ç±»å‹çš„åˆ«å
- ä½¿ç”¨åå¼•å·è¡¨ç¤º

```v
laugh := `ğŸ¤£`

// 1. ä¸€äº› `rune` ä¸ `string` ä¹‹é—´è½¬æ¢çš„æ–¹æ³•
// 1.1 bytes(): `rune` è½¬ `[]u8`
laugh_bytes := laugh.bytes() // [240, 159, 164, 163]

// 1.2 runes(): `string` è½¬ `[]rune`
string_to_runes := "ä½ å¥½ï¼Œä¸–ç•Œ".runes() // [`ä½ `, `å¥½`, `ï¼Œ`, `ä¸–`, `ç•Œ`]

// 1.3 str(): `rune` è½¬ `string`
laugh_str := laugh.str() // 'ğŸ¤£'
// 1.4 string(): `[]rune` è½¬ `string`
runes_to_string := string_to_runes.string() // 'ä½ å¥½ï¼Œä¸–ç•Œ'

println(laugh_bytes)
println(string_to_runes)
println(laugh_str)
println(runes_to_string)

// 2. å…«è¿›åˆ¶ã€åå…­è¿›åˆ¶é€ƒé€¸åºåˆ—å’Œ Unicodeï¼Œä¹Ÿæº˜è¡¨ç¤º Rune
oct := `\141`
hex := `\x61`
uni := `\u0061`
run := `a`

// éƒ½ä”º `true`
println(oct == run)
println(hex == run)
println(uni == run)
```

### å­—ç¬¦ä¸²

éœ‘ï¼š

- ä½¿ç”¨å•å¼•å·ï¼ŒUTF-8 ç¼–ç 
- æ˜¯åªè¯»çš„ `[]u8` æ•°ç»„ï¼Œæ‰€ä»¥å­—ç¬¦ä¸²ä¸å¯å˜

```v
spring := 'æ˜¥å¤©'

// 1. éœ‘
// 1.1 ç´¢å¼•ï¼Œå¾—åˆ°å­—èŠ‚ï¼Œä¸æ˜¯ `rune`ï¼Œä¹Ÿä¸æ˜¯å­—ç¬¦ä¸²
println(spring[0]) // 230
// 1.2 åˆ‡ç‰‡ï¼Œå¾—åˆ°å­—ç¬¦ä¸²
println(spring[0..3]) // 'æ˜¥'
//1.3 é•¿åº¦ï¼Œå¾—åˆ°å­—èŠ‚æ•°ï¼Œä¸æ˜¯å­—ç¬¦æ•°
println(spring.len) // 6

// 2. ä¸€äº›è½¬æ¢æ–¹æ³•
// 2.1 bytes(): `string` è½¬ `[]u8`
println(spring.bytes()) // [230, 152, 165, 229, 164, 169]
// 2.2 bytestr(): `[]u8` è½¬ `string`
println([u8(230), 152, 165, 229, 164, 169].bytestr()) // 'æ˜¥å¤©'
// 2.3 ascii_str(): `u8` è½¬ `string`
println(u8(78).ascii_str()) // 'N'
// 2.4 int(): `string` è½¬ `int`
println('42'.int()) // 42
println('0xc3'.int()) // 195

// 3. å…«è¿›åˆ¶ã€åå…­è¿›åˆ¶é€ƒé€¸åºåˆ—å’Œ Unicodeï¼Œä¹Ÿæº˜è¡¨ç¤ºå­—ç¬¦ä¸²
oct := 'z\141be'
hex := 'z\x61be'
uni := 'z\u0061be'
run := 'zabe'

// éƒ½ä”º `true`
println(oct == run)
println(hex == run)
println(uni == run)

// 4. åŸç”Ÿå­—ç¬¦ä¸²ï¼Œé€ƒé€¸åºåˆ—æ— æ•ˆ
println(r'hello\nworld') // 'hello\nworld'
```

å­—ç¬¦ä¸²æ’å€¼ï¼š

- æ’å€¼ä½¿ç”¨ `${expr}`ï¼Œ`expr` æº˜æ˜¯å˜é‡æˆ–è¡¨è¾¾å¼
- æ’å€¼å¹¶æ ¼å¼åŒ–ï¼Œä½¿ç”¨ `${varname:[flags][width][.precision][type]}`

```v
s1 := 'æ˜¥å¤©'
s2 := 'å¤å¤©'
println('æˆ‘å–œæ¬¢${s1}å’Œ${s2}ã€‚') // 'æˆ‘å–œæ¬¢æ˜¥å¤©å’Œå¤å¤©ã€‚'
```

å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œä½¿ç”¨ `+` ãªã€‚

## å‡½æ•°

éœ‘ï¼š

- ä¸å…è®¸å‡½æ•°çš„**é‡è½½**
- å­˜åœ¨**æå‡**ï¼Œå³å‡½æ•°å£°æ˜æº˜å†™åœ¨å‡½æ•°è°ƒç”¨çš„åé¢

```v
module main

fn main() {
    a, b := foo(4, 5)
    println(a) // 8
    println(b) // 15
}

// 1. å‚æ•°çš„ç±»å‹æ³¨è§£å†™åœ¨å‚æ•°åé¢ï¼Œä¸éœ€è¦å†’å·
// 2. è¿”å›å¤šä¸ªå€¼æ—¶ï¼Œå‡½æ•°è¿”å›å€¼çš„ç±»å‹æ³¨è§£
fn foo(x int, y int) (int, int) {
    // 2. è¿”å›å¤šä¸ªå€¼
    return x * 2, y * 3
}
```

## æ¨¡å—

éœ‘ï¼š

- ç‰©å“é»˜è®¤ç§æœ‰ï¼Œä½¿ç”¨ `pub` è®©å®ƒä»¬å˜ä”ºå…¬å…±ï¼Œå…¶ä»–æ¨¡å—æ‰èƒ½è®¿é—®
